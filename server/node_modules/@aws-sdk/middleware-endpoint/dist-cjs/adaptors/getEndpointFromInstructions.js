"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getEndpointFromInstructions = void 0;
const getEndpointFromInstructions = async (commandInput, instructionsSupplier, clientConfig, context) => {
    const endpointParams = {};
    const instructions = (instructionsSupplier.getEndpointParameterInstructions || (() => null))() || {};
    if (typeof clientConfig.endpointProvider !== "function") {
        throw new Error("config.endpointProvider is not set.");
    }
    for (const [name, instruction] of Object.entries(instructions)) {
        switch (instruction.type) {
            case "staticContextParams":
                endpointParams[name] = instruction.value;
                break;
            case "contextParams":
                endpointParams[name] = commandInput[instruction.name];
                break;
            case "clientContextParams":
            case "builtInParams":
                endpointParams[name] = await createConfigProvider(instruction.name, clientConfig)();
                break;
            default:
                throw new Error("Unrecognized endpoint parameter instruction: " + JSON.stringify(instruction));
        }
    }
    const endpoint = clientConfig.endpointProvider(endpointParams, context);
    return endpoint;
};
exports.getEndpointFromInstructions = getEndpointFromInstructions;
const createConfigProvider = (configKey, config) => {
    const configProvider = async () => {
        const configValue = config[configKey];
        if (typeof configValue === "function") {
            return configValue();
        }
        return configValue;
    };
    return configProvider;
};
